/**
* Keybind.js
*
* Version: 0.1
* Author: Atshi.com
* Description: Library for creating keybindings within any web application.
*
* Copyright (C) 2013 Atshi
*
* License: MIT
*/
!function(){var a,b,c,d={}.hasOwnProperty;c=function(){function a(){}return a.typeIsArray=function(a){return a&&"object"==typeof a&&a instanceof Array&&"number"==typeof a.length&&"function"==typeof a.splice&&!a.propertyIsEnumerable("length")},a.cloneObject=function(a){var b,c,e;if("string"==typeof a||"number"==typeof a)return a;c=this.typeIsArray(a)?[]:{};for(b in a)d.call(a,b)&&(e=a[b],c[b]=a[b]&&"object"==typeof a[b]?this.cloneObject(a[b]):a[b]);return c},a.mergeInto=function(a,b){var c,e,f;f=[];for(c in a)d.call(a,c)&&(e=a[c],null!=b[c]?this.typeIsArray(b[c])&&b[c].length>0?f.push(b[c]=b[c].concat(a[c])):f.push(this.mergeInto(a[c],b[c])):f.push(b[c]=this.cloneObject(a[c])));return f},a}(),b=function(){function a(){}return a.TIMEOUT=300,a.shortcuts=[],a.keybindings=[],a.globalshortcuts=[],a.globalkeybindings=[],a.modevalues=[],a.initiated=!1,a.sequence="",a.prevSequence="",a.storedCount="",a.timeoutInterval=null,a.mode=null,a.Keys={TAB:9,SHIFT:16,CTRL:17,ALT:18,CAPS_LOCK:20,ESCAPE:27,CMD_LEFT:91,CMD_RIGHT:93,ZERO:"0".charCodeAt(0),NINE:"9".charCodeAt(0)},a.modifiers={TAB:a.Keys.TAB,SHIFT:a.Keys.SHIFT,S:a.Keys.SHIFT,CTRL:a.Keys.CTRL,C:a.Keys.CTRL,ALT:a.Keys.ALT,CAPS_LOCK:a.Keys.CAPS_LOCK,CAPSLOCK:a.Keys.CAPS_LOCK,ESCAPE:a.Keys.ESCAPE,ESC:a.Keys.ESCAPE,CMD_LEFT:a.Keys.CMD_LEFT,CMDLEFT:a.Keys.CMD_LEFT,CMDL:a.Keys.CMD_LEFT,CMD_RIGHT:a.Keys.CMD_RIGHT,CMDRIGHT:a.Keys.CMD_RIGHT,CMDR:a.Keys.CMD_RIGHT},a.init=function(){if(!this.initiated){if(this.initiated=!0,document.attachEvent)return document.attachEvent("onkeydown",function(){return this.onKeyDown});if(document.addEventListener)return document.addEventListener("keydown",this.onKeyDown,!1)}},a.setMode=function(a){return this.mode=a,this.updateKeybindings()},a.getMode=function(){return this.mode},a.getKeybindings=function(){var a,b,e,f;b=c.cloneObject(this.globalkeybindings),f=this.modevalues;for(a in f)d.call(f,a)&&(e=f[a],c.mergeInto(this.modevalues[a].keybindings,b));return b},a.getCurrentKeybindings=function(){return this.keybindings},a.updateKeybindings=function(){return this.shortcuts=c.cloneObject(this.globalshortcuts),this.keybindings=c.cloneObject(this.globalkeybindings),this.mode&&null!=this.modevalues[this.mode]?(c.mergeInto(this.modevalues[this.mode].keybindings,this.keybindings),c.mergeInto(this.modevalues[this.mode].shortcuts,this.shortcuts)):void 0},a.onKeyDown=function(b){return a.addToSequence(String.fromCharCode(b.keyCode))},a.addToSequence=function(a){var b;return null!=this.timeoutInterval&&(clearTimeout(this.timeoutInterval),this.timeoutInterval=null),b=a.charCodeAt(0),!this.sequence&&b>=this.Keys.ZERO&&b<=this.Keys.NINE?this.storedCount+=a:(this.prevSequence=this.sequence,this.sequence+=a,this.sequenceHasChildren(this.sequence)?this.timeoutInterval=setTimeout(this.findSequenceAndExecute.bind(this),this.TIMEOUT):this.findSequenceAndExecute())},a.findSequenceAndExecute=function(){var a;return this.sequenceActionExists(this.sequence)?(this.executeSequence(this.sequence),a=null):this.sequenceActionExists(this.prevSequence)&&(this.executeSequence(this.prevSequence),a=this.sequence.slice(-1)),this.sequence="",this.prevSequence="",this.storedCount="",null!=this.timeoutInterval&&(clearTimeout(this.timeoutInterval),this.timeoutInterval=null),null!=a?this.addToSequence(a):void 0},a.executeSequence=function(a){var b,c,d,e,f,g;for(b=Math.max(1,parseInt(this.storedCount)),b||(b=1),f=this.keybindings[a],g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.getAction().call(window,b,c.getShortcut(),c.getDescription()));return g},a.sequenceActionExists=function(a){return null!=this.keybindings[a]&&this.keybindings[a].length>0},a.sequenceHasChildren=function(a){var b,c,e,f,g,h;for(b=this.shortcuts,e=g=0,h=a.length;h>=0?h>g:g>h;e=h>=0?++g:--g){if(c=a.charAt(e),null==b[c])return!1;b=b[c]}for(f in b)if(d.call(b,f))return!0;return!1},a.removeLastInSequence=function(a){var b,c,d,e,f;for(b=this.shortcuts,d=e=0,f=a.length;f>=0?f>e:e>f;d=f>=0?++e:--e){if(c=a.charAt(d),d===a.length-1&&delete b[c],null==b[c])return;b=b[c]}},a.register=function(a){var b,c,d,e,f,g,h,i;for(a.getMode()?(null==this.modevalues[a.getMode()]&&(this.modevalues[a.getMode()]={keybindings:[],shortcuts:[]}),e=this.modevalues[a.getMode()].keybindings,g=this.modevalues[a.getMode()].shortcuts):(e=this.globalkeybindings,g=this.globalshortcuts),null==e[a.getInternalShortcut()]&&(e[a.getInternalShortcut()]=[]),e[a.getInternalShortcut()].push(a),b=g,f=a.getInternalShortcut(),d=h=0,i=f.length;i>=0?i>h:h>i;d=i>=0?++h:--h)c=f.charAt(d),null==b[c]&&(b[c]=[]),b=b[c];return this.updateKeybindings()},a.unregister=function(a){var b,c,d,e,f;for(a.getMode()?(c=this.modevalues[a.getMode()].keybindings,f=this.modevalues[a.getMode()].shortcuts):(c=this.globalkeybindings,f=this.globalshortcuts),e=a.getInternalShortcut(),b=c[e].indexOf(a),c[e].splice(b,1),d=e;!this.sequenceHasChildren(d)&&d.length>0&&(null==c[d]||0===c[d].length);)this.removeLastInSequence(d),d=d.slice(0,-1);return this.updateKeybindings()},a}.call(this),a=function(){function a(a,c,e,f){var g,h,i,j;g=a.toUpperCase(),j=b.modifiers;for(h in j)d.call(j,h)&&(i=j[h],g=g.replace("<"+h+">",String.fromCharCode(i)));this.getShortcut=function(){return a},this.getInternalShortcut=function(){return g},this.getDescription=function(){return e},this.getAction=function(){return c},this.getMode=function(){return f},b.init(),b.register(this)}return a.prototype.remove=function(){return b.unregister(this)},a.setMode=function(a){return b.setMode(a)},a.getMode=function(){return b.getMode()},a.getRegistered=function(){var a,c,e,f,g,h,i;f=[],i=b.getKeybindings();for(c in i)if(d.call(i,c))for(a=i[c],g=0,h=a.length;h>g;g++)e=a[g],f.push(e);return f},a}(),window.Keybinding=a}.call(this);