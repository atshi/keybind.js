/**
* Keybind.js
*
* Version: 0.1
* Author: Atshi.com
* Description: Library for creating keybindings within any web application.
*
* Copyright (C) 2013 Atshi
*
* License: MIT
*/
!function(){var a,b,c={}.hasOwnProperty;a=function(){function a(a,c,d){this.getShortcut=function(){return a},this.getDescription=function(){return d},this.getAction=function(){return c},b.init(),b.register(this)}return a.prototype.remove=function(){return b.unregister(this)},a.getRegistered=function(){var a,d,e,f,g,h,i;f=[],i=b.keybindings;for(d in i)if(c.call(i,d))for(a=i[d],g=0,h=a.length;h>g;g++)e=a[g],f.push(e);return f},a}(),b=function(){function a(){}return a.TIMEOUT=300,a.shortcuts=[],a.keybindings=[],a.initiated=!1,a.sequence="",a.prevSequence="",a.storedCount="",a.timeoutInterval=null,a.Keys={ZERO:"0".charCodeAt(0),NINE:"9".charCodeAt(0)},a.init=function(){if(!this.initiated){if(this.initiated=!0,document.attachEvent)return document.attachEvent("onkeypress",function(){return this.onKeyPress});if(document.addEventListener)return document.addEventListener("keypress",this.onKeyPress,!1)}},a.onKeyPress=function(b){return a.addToSequence(String.fromCharCode(b.charCode))},a.addToSequence=function(a){var b;return null!=this.timeoutInterval&&(clearTimeout(this.timeoutInterval),this.timeoutInterval=null),b=a.charCodeAt(0),!this.sequence&&b>=this.Keys.ZERO&&b<=this.Keys.NINE?this.storedCount+=a:(this.prevSequence=this.sequence,this.sequence+=a,this.sequenceHasChildren(this.sequence)?this.timeoutInterval=setTimeout(this.findSequenceAndExecute.bind(this),this.TIMEOUT):this.findSequenceAndExecute())},a.findSequenceAndExecute=function(){var a;return this.sequenceActionExists(this.sequence)?(this.executeSequence(this.sequence),a=null):this.sequenceActionExists(this.prevSequence)&&(this.executeSequence(this.prevSequence),a=this.sequence.slice(-1)),this.sequence="",this.prevSequence="",this.storedCount="",null!=this.timeoutInterval&&(clearTimeout(this.timeoutInterval),this.timeoutInterval=null),null!=a?this.addToSequence(a):void 0},a.executeSequence=function(a){var b,c,d,e,f,g;for(b=Math.max(1,parseInt(this.storedCount)),b||(b=1),f=this.keybindings[a],g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.getAction().call(window,b,a,c.getDescription()));return g},a.sequenceActionExists=function(a){return null!=this.keybindings[a]&&this.keybindings[a].length>0},a.sequenceHasChildren=function(a){var b,d,e,f,g,h;for(b=this.shortcuts,e=g=0,h=a.length;h>=0?h>g:g>h;e=h>=0?++g:--g){if(d=a.charAt(e),null==b[d])return!1;b=b[d]}for(f in b)if(c.call(b,f))return!0;return!1},a.removeLastInSequence=function(a){var b,c,d,e,f;for(b=this.shortcuts,d=e=0,f=a.length;f>=0?f>e:e>f;d=f>=0?++e:--e){if(c=a.charAt(d),d===a.length-1&&delete b[c],null==b[c])return;b=b[c]}},a.register=function(a){var b,c,d,e,f,g,h;for(null==this.keybindings[a.getShortcut()]&&(this.keybindings[a.getShortcut()]=[]),this.keybindings[a.getShortcut()].push(a),b=this.shortcuts,e=a.getShortcut(),h=[],d=f=0,g=e.length;g>=0?g>f:f>g;d=g>=0?++f:--f)c=e.charAt(d),null==b[c]&&(b[c]=[]),h.push(b=b[c]);return h},a.unregister=function(a){var b,c,d,e;for(d=a.getShortcut(),b=this.keybindings[d].indexOf(a),this.keybindings[d].splice(b,1),c=d,e=[];!this.sequenceHasChildren(c)&&c.length>0&&(null==this.keybindings[c]||0===this.keybindings[c].length);)this.removeLastInSequence(c),e.push(c=c.slice(0,-1));return e},a}.call(this),window.Keybinding=a}.call(this);